{# Basierend auf einem Template-Layout ‚Äì vermutlich enth√§lt es Grundstruktur wie <html>, <head>, <body> usw. #}
    {% extends 'layout.html' %}
    
    {# Setzt den Seitentitel im Browser #}
    {% block title %}Dashboard{% endblock %}
    
    {# Hauptinhalt der Seite beginnt #}
    {% block content %}
    
    <!-- Kopfbereich des Dashboards -->
    <div class="topbar">
        <h2 class="page-title">
            <span class="material-icons">calendar_today</span>
            Dein Dashboard
        </h2>
        <div class="profile-dropdown">
            <!-- Platzhalter f√ºr Benutzerprofil-Dropdown -->
        </div>
    </div>
    
    <!-- Grid-Container mit mehreren Kacheln (cards) -->
    <div class="grid-container">
    
        <!-- Terminformular -->
        <div class="card">
            <h3>Neuen Termin hinzuf√ºgen</h3>
            <form method="POST" action="{{ url_for('dashboard') }}">
                <input type="text" name="event_title" placeholder="Titel" required>
                <input type="date" name="event_date" required>
    
                <label for="event_repeat">Wiederholung:</label>
                <select name="event_repeat" id="event_repeat">
                    <option value="none">Einmalig</option>
                    <option value="daily">T√§glich</option>
                    <option value="weekly">W√∂chentlich</option>
                    <option value="monthly">Monatlich</option>
                </select>
    
                <button type="submit">+ Termin hinzuf√ºgen</button>
            </form>
        </div>
    
        <!-- Aufgabenformular -->
        <div class="card">
            <h3>Neue Aufgabe</h3>
            <form method="POST" action="{{ url_for('dashboard') }}">
                <input type="text" name="task_description" placeholder="Aufgabe" required>
                
                <label for="task_repeat">Wiederholung:</label>
                <select name="task_repeat" id="task_repeat">
                    <option value="none">Einmalig</option>
                    <option value="daily">T√§glich</option>
                    <option value="weekly">W√∂chentlich</option>
                    <option value="monthly">Monatlich</option>
                </select>
    
                <button type="submit">+ Aufgabe hinzuf√ºgen</button>
            </form>
        </div>
    
        <!-- Anzeige der Termine -->
        <div class="card">
            <h3><span class="material-icons">calendar_today</span> Deine Termine</h3>
            {% if events %}
                <ul>
                    {% for event in events %}
                    <li>
                        <span>{{ event.title }} am {{ event.date }}</span>
                        <a href="/event/edit/{{ event.id }}" class="edit-link">‚úèÔ∏è</a>
                        <a href="/event/delete/{{ event.id }}" class="delete-link">üóëÔ∏è</a>
                    </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>Keine Termine eingetragen.</p>
            {% endif %}
        </div>
    
        <!-- Anzeige der Aufgaben -->
        <div class="card">
            <h3><span class="material-icons">checklist</span> Deine Aufgaben</h3>
            {% if tasks %}
                <ul>
                    {% for task in tasks %}
                        <li>
                            <!-- Erledigt-Button -->
                            <form action="/task/done/{{ task.id }}" method="GET" style="display:inline;">
                                <button type="submit" style="border: none; background: none; cursor: pointer;">
                                    <span class="material-icons">
                                        {{ 'check_box' if task.done else 'check_box_outline_blank' }}
                                    </span>
                                </button>
                            </form>
    
                            <!-- Aufgabenbeschreibung mit Wiederholungsicon -->
                            <span>
                                {{ task.description }}
                                {% if task.repeat != 'none' %}
                                    <span class="material-icons" style="font-size: 16px; vertical-align: middle;" title="Wiederkehrend">autorenew</span>
                                {% endif %}
                            </span>
    
                            <!-- L√∂schlink -->
                            <a href="/task/delete/{{ task.id }}" class="delete-link">üóëÔ∏è</a>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>Keine Aufgaben eingetragen.</p>
            {% endif %}
        </div>
    
        <!-- Aufgabenstatistik -->
        <div class="card">
            <h3><span class="material-icons">bar_chart</span> Aufgaben-Statistik</h3>
            <p><strong>Gesamtaufgaben:</strong> {{ total_tasks }}</p>
            <p><strong>Erledigte Aufgaben:</strong> {{ completed_tasks }}</p>
            <p><strong>Erledigungsrate:</strong> {{ completion_rate }}%</p>
        </div>
    
        <!-- Export-Optionen -->
        <div class="card export-card">
            <div><a href="/export">üì• Daten als CSV exportieren</a></div>
            <div><a href="/export-filter">üì§ Gefilterter CSV-Export</a></div>
            <div><a href="/backup">üóÑÔ∏è Lokales Backup erstellen</a></div>
        </div>
    
    </div>
    {% endblock %}
    
    {# Externe Stylesheets, z.‚ÄØB. f√ºr Kalenderlayout #}
    {% block styles %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/calendar.css') }}">
    {% endblock %}
    
    {# JavaScript f√ºr FullCalendar Integration #}
    {% block scripts %}
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.js"></script>
    
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const calendarEl = document.getElementById('calendar');
        if (calendarEl) {
          const calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            locale: 'de',
            height: 600,
            headerToolbar: {
              left: 'prev,next today',
              center: 'title',
              right: 'dayGridMonth,listMonth'
            },
            events: '/api/events'  // Holt sich die Termine als JSON
          });
          calendar.render();  // Rendert den Kalender im DOM
        }
      });
    </script>
    {% endblock %}    